<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LLNL Nanosecond Gated Camera: nsCamera.utils.FlatField Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="llnl60.jpg"/></td>
  <td id="projectalign">
   <div id="projectname">LLNL Nanosecond Gated Camera<span id="projectnumber">&#160;2.1.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="namespaces.html"><span>Package&#160;List</span></a></li>
      <li><a href="namespacemembers.html"><span>Package&#160;Members</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacens_camera.html">nsCamera</a></li><li class="navelem"><a class="el" href="namespacens_camera_1_1utils.html">utils</a></li><li class="navelem"><a class="el" href="namespacens_camera_1_1utils_1_1_flat_field.html">FlatField</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">nsCamera.utils.FlatField Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a5d4b3787519c89b9fd4a549dca06582f" id="r_a5d4b3787519c89b9fd4a549dca06582f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5d4b3787519c89b9fd4a549dca06582f">getFilenames</a> (frame=&quot;Frame 1&quot;)</td></tr>
<tr class="separator:a5d4b3787519c89b9fd4a549dca06582f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8145e50519ebddbab48a79a162c26bba" id="r_a8145e50519ebddbab48a79a162c26bba"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8145e50519ebddbab48a79a162c26bba">getROIvector</a> (imgfilename, roi)</td></tr>
<tr class="separator:a8145e50519ebddbab48a79a162c26bba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f78b2edfbe435cff069ea2f66c82e2d" id="r_a6f78b2edfbe435cff069ea2f66c82e2d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6f78b2edfbe435cff069ea2f66c82e2d">tslopes</a> (x, y)</td></tr>
<tr class="separator:a6f78b2edfbe435cff069ea2f66c82e2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63464f55c97242a78ad511f0cb1a4523" id="r_a63464f55c97242a78ad511f0cb1a4523"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a63464f55c97242a78ad511f0cb1a4523">generateFF</a> (FRAMES=[&quot;Frame_0&quot;, &quot;Frame_1&quot;, &quot;Frame_2&quot;, &quot;Frame_3&quot;], roi=[0, 0, 512, 1024], <a class="el" href="#a6d1d81834ed2bf0e506f3132781aa8af">directory</a>=&quot;&quot;, ncores=-1)</td></tr>
<tr class="separator:a63464f55c97242a78ad511f0cb1a4523"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae996c0f2a121597af974fa1852099033" id="r_ae996c0f2a121597af974fa1852099033"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae996c0f2a121597af974fa1852099033">removeFF</a> (filename, <a class="el" href="#a6d1d81834ed2bf0e506f3132781aa8af">directory</a>=&quot;&quot;, roi=[0, 0, 512, 1024])</td></tr>
<tr class="separator:ae996c0f2a121597af974fa1852099033"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af674d4ff04cb43f0cfbe5f332661107f" id="r_af674d4ff04cb43f0cfbe5f332661107f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af674d4ff04cb43f0cfbe5f332661107f">removeFFall</a> (<a class="el" href="#a6d1d81834ed2bf0e506f3132781aa8af">directory</a>=&quot;&quot;, FRAMES=[&quot;Frame_0&quot;, &quot;Frame_1&quot;, &quot;Frame_2&quot;, &quot;Frame_3&quot;], roi=[0, 0, 512, 1024])</td></tr>
<tr class="separator:af674d4ff04cb43f0cfbe5f332661107f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a833f8f4dd0c2e38167b83428f50f6d19" id="r_a833f8f4dd0c2e38167b83428f50f6d19"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a833f8f4dd0c2e38167b83428f50f6d19">parser</a> = argparse.ArgumentParser()</td></tr>
<tr class="separator:a833f8f4dd0c2e38167b83428f50f6d19"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab9e79cc1cb20a69c92dfa2d5012d52ab" id="r_ab9e79cc1cb20a69c92dfa2d5012d52ab"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab9e79cc1cb20a69c92dfa2d5012d52ab">action</a></td></tr>
<tr class="separator:ab9e79cc1cb20a69c92dfa2d5012d52ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a60151a4f4eef470251c86a9883022095" id="r_a60151a4f4eef470251c86a9883022095"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a60151a4f4eef470251c86a9883022095">dest</a></td></tr>
<tr class="separator:a60151a4f4eef470251c86a9883022095"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a775f9059ac91b55f234f75a4b3a562c2" id="r_a775f9059ac91b55f234f75a4b3a562c2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a775f9059ac91b55f234f75a4b3a562c2">default</a></td></tr>
<tr class="separator:a775f9059ac91b55f234f75a4b3a562c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad7aef75a54abd0b012003739038ee380" id="r_ad7aef75a54abd0b012003739038ee380"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad7aef75a54abd0b012003739038ee380">help</a></td></tr>
<tr class="separator:ad7aef75a54abd0b012003739038ee380"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a918fc8083a2b6bf4a422bd1a787d76d4" id="r_a918fc8083a2b6bf4a422bd1a787d76d4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a918fc8083a2b6bf4a422bd1a787d76d4">nargs</a></td></tr>
<tr class="separator:a918fc8083a2b6bf4a422bd1a787d76d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8e8aa32409d2ee808364172b3ed4ef9" id="r_aa8e8aa32409d2ee808364172b3ed4ef9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa8e8aa32409d2ee808364172b3ed4ef9">args</a> = parser.parse_args()</td></tr>
<tr class="separator:aa8e8aa32409d2ee808364172b3ed4ef9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac92f16b1d6d472f96079c4424a03bc8a" id="r_ac92f16b1d6d472f96079c4424a03bc8a"><td class="memItemLeft" align="right" valign="top">list&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac92f16b1d6d472f96079c4424a03bc8a">framelist</a> = [&quot;Frame_&quot; + str(frame) for frame in args.frames]</td></tr>
<tr class="separator:ac92f16b1d6d472f96079c4424a03bc8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d1d81834ed2bf0e506f3132781aa8af" id="r_a6d1d81834ed2bf0e506f3132781aa8af"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6d1d81834ed2bf0e506f3132781aa8af">directory</a></td></tr>
<tr class="separator:a6d1d81834ed2bf0e506f3132781aa8af"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">Functions for batch flat-field image corrections

***Do not use this file as a template for new code development***

Author: Jeremy Martin Hill (jerhill@llnl.gov)
Author: Matthew Dayton (dayton5@llnl.gov)

Copyright (c) 2025, Lawrence Livermore National Security, LLC.  All rights reserved.
LLNL-CODE-838080

This work was produced at the Lawrence Livermore National Laboratory (LLNL) under 
contract no. DE-AC52-07NA27344 (Contract 44) between the U.S. Department of Energy (DOE)
and Lawrence Livermore National Security, LLC (LLNS) for the operation of LLNL.
'nsCamera' is distributed under the terms of the MIT license. All new contributions must
be made under this license.

Version: 2.1.2 (February 2025)
</pre> </div><h2 class="groupheader">Function Documentation</h2>
<a id="a63464f55c97242a78ad511f0cb1a4523" name="a63464f55c97242a78ad511f0cb1a4523"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a63464f55c97242a78ad511f0cb1a4523">&#9670;&#160;</a></span>generateFF()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">nsCamera.utils.FlatField.generateFF </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>FRAMES</em><span class="paramdefsep"> = </span><span class="paramdefval">[&quot;Frame_0&quot;,&#160;&quot;Frame_1&quot;,&#160;&quot;Frame_2&quot;,&#160;&quot;Frame_3&quot;]</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>roi</em><span class="paramdefsep"> = </span><span class="paramdefval">[0,&#160;0,&#160;512,&#160;1024]</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>directory</em><span class="paramdefsep"> = </span><span class="paramdefval">&quot;&quot;</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>ncores</em><span class="paramdefsep"> = </span><span class="paramdefval">-1</span></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_flat_field_8py_source.html#l00058">58</a> of file <a class="el" href="_flat_field_8py_source.html">FlatField.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   63</span>):</div>
<div class="line"><span class="lineno">   64</span>    <span class="comment"># TODO: documentation</span></div>
<div class="line"><span class="lineno">   65</span>    <span class="comment"># use of ROI here not compatible with use of ROI in removeFF</span></div>
<div class="line"><span class="lineno">   66</span> </div>
<div class="line"><span class="lineno">   67</span>    <span class="keywordflow">if</span> directory:</div>
<div class="line"><span class="lineno">   68</span>        cwd = os.getcwd()</div>
<div class="line"><span class="lineno">   69</span>        newpath = os.path.join(cwd, directory)</div>
<div class="line"><span class="lineno">   70</span>        os.chdir(newpath)</div>
<div class="line"><span class="lineno">   71</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> FRAMES:</div>
<div class="line"><span class="lineno">   72</span>        print(<span class="stringliteral">&quot;No framelist provided, defaulting to four frames&quot;</span>)</div>
<div class="line"><span class="lineno">   73</span>        FRAMES = [<span class="stringliteral">&quot;Frame_0&quot;</span>, <span class="stringliteral">&quot;Frame_1&quot;</span>, <span class="stringliteral">&quot;Frame_2&quot;</span>, <span class="stringliteral">&quot;Frame_3&quot;</span>]</div>
<div class="line"><span class="lineno">   74</span>    <span class="keywordflow">for</span> f <span class="keywordflow">in</span> FRAMES:</div>
<div class="line"><span class="lineno">   75</span>        files = getFilenames(frame=f)</div>
<div class="line"><span class="lineno">   76</span>        imgslist = [getROIvector(fn, roi) <span class="keywordflow">for</span> fn <span class="keywordflow">in</span> files]  <span class="comment"># a list of flattened images</span></div>
<div class="line"><span class="lineno">   77</span>        imgsarray = np.vstack(imgslist)  <span class="comment"># turn the list into an array</span></div>
<div class="line"><span class="lineno">   78</span>        npix = np.shape(imgsarray)[1]  <span class="comment"># total number of pixels</span></div>
<div class="line"><span class="lineno">   79</span>        x = np.median(imgsarray, axis=1)  <span class="comment"># median of each image used for flat fielding</span></div>
<div class="line"><span class="lineno">   80</span>        y = []</div>
<div class="line"><span class="lineno">   81</span>        <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(npix):</div>
<div class="line"><span class="lineno">   82</span>            <span class="comment"># each member of y represents a pixel, as a list of magnitudes over all the</span></div>
<div class="line"><span class="lineno">   83</span>            <span class="comment">#   images</span></div>
<div class="line"><span class="lineno">   84</span>            y.append(imgsarray[:, i])</div>
<div class="line"><span class="lineno">   85</span>        <span class="comment"># get pixel gain and offset for flatfield ff using Thiel-Sen slopes</span></div>
<div class="line"><span class="lineno">   86</span>        ff = []</div>
<div class="line"><span class="lineno">   87</span>        ff = parallel.Parallel(n_jobs=ncores, verbose=5, pre_dispatch=<span class="stringliteral">&quot;2 * n_jobs&quot;</span>)(</div>
<div class="line"><span class="lineno">   88</span>            delayed(tslopes)(x, pixel) <span class="keywordflow">for</span> pixel <span class="keywordflow">in</span> y</div>
<div class="line"><span class="lineno">   89</span>        )</div>
<div class="line"><span class="lineno">   90</span>        <span class="comment"># x is the dependent variable; here uses median of image as characteristic of</span></div>
<div class="line"><span class="lineno">   91</span>        <span class="comment">#   noise level</span></div>
<div class="line"><span class="lineno">   92</span>        m, c = zip(*ff)  <span class="comment"># separate into gain and offset</span></div>
<div class="line"><span class="lineno">   93</span>        m = np.array(m)</div>
<div class="line"><span class="lineno">   94</span>        m[m &lt; 0.1] = 0.1  <span class="comment"># handle outliers</span></div>
<div class="line"><span class="lineno">   95</span>        m[m &gt; 1000] = 1000  <span class="comment"># handle outliers</span></div>
<div class="line"><span class="lineno">   96</span>        m = 1.0 / m</div>
<div class="line"><span class="lineno">   97</span>        m = m.reshape(roi[3] - roi[1], roi[2] - roi[0])  <span class="comment"># turn into matrix</span></div>
<div class="line"><span class="lineno">   98</span>        c = np.array(c).reshape(roi[3] - roi[1], roi[2] - roi[0])  <span class="comment"># turn into matrix</span></div>
<div class="line"><span class="lineno">   99</span> </div>
<div class="line"><span class="lineno">  100</span>        <span class="keyword">with</span> open(<span class="stringliteral">&quot;px_gain_%s.txt&quot;</span> % f.replace(<span class="stringliteral">&quot;Frame_&quot;</span>, <span class="stringliteral">&quot;f&quot;</span>), <span class="stringliteral">&quot;w+&quot;</span>) <span class="keyword">as</span> file:</div>
<div class="line"><span class="lineno">  101</span>            np.savetxt(file, m)</div>
<div class="line"><span class="lineno">  102</span>        <span class="keyword">with</span> open(<span class="stringliteral">&quot;px_off_%s.txt&quot;</span> % f.replace(<span class="stringliteral">&quot;Frame_&quot;</span>, <span class="stringliteral">&quot;f&quot;</span>), <span class="stringliteral">&quot;w+&quot;</span>) <span class="keyword">as</span> file:</div>
<div class="line"><span class="lineno">  103</span>            np.savetxt(file, c)</div>
<div class="line"><span class="lineno">  104</span> </div>
<div class="line"><span class="lineno">  105</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a5d4b3787519c89b9fd4a549dca06582f" name="a5d4b3787519c89b9fd4a549dca06582f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5d4b3787519c89b9fd4a549dca06582f">&#9670;&#160;</a></span>getFilenames()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">nsCamera.utils.FlatField.getFilenames </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>frame</em><span class="paramdefsep"> = </span><span class="paramdefval">&quot;Frame&#160;1&quot;</span></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">get a list of tiff filenames in current working director for frame
</pre> 
<p class="definition">Definition at line <a class="el" href="_flat_field_8py_source.html#l00032">32</a> of file <a class="el" href="_flat_field_8py_source.html">FlatField.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   32</span><span class="keyword">def </span>getFilenames(frame=&quot;Frame 1&quot;):</div>
<div class="line"><span class="lineno">   33</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   34</span><span class="stringliteral">    get a list of tiff filenames in current working director for frame</span></div>
<div class="line"><span class="lineno">   35</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   36</span>    onlyfiles = next(os.walk(<span class="stringliteral">&quot;./&quot;</span>))[2]</div>
<div class="line"><span class="lineno">   37</span>    <span class="keywordflow">return</span> [k <span class="keywordflow">for</span> k <span class="keywordflow">in</span> onlyfiles <span class="keywordflow">if</span> frame <span class="keywordflow">in</span> k <span class="keywordflow">and</span> <span class="stringliteral">&quot;tif&quot;</span> <span class="keywordflow">in</span> k]</div>
<div class="line"><span class="lineno">   38</span> </div>
<div class="line"><span class="lineno">   39</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a8145e50519ebddbab48a79a162c26bba" name="a8145e50519ebddbab48a79a162c26bba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8145e50519ebddbab48a79a162c26bba">&#9670;&#160;</a></span>getROIvector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">nsCamera.utils.FlatField.getROIvector </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>imgfilename</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>roi</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">return a numpy row vector of version of the image
</pre> 
<p class="definition">Definition at line <a class="el" href="_flat_field_8py_source.html#l00040">40</a> of file <a class="el" href="_flat_field_8py_source.html">FlatField.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   40</span><span class="keyword">def </span>getROIvector(imgfilename, roi):</div>
<div class="line"><span class="lineno">   41</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   42</span><span class="stringliteral">    return a numpy row vector of version of the image</span></div>
<div class="line"><span class="lineno">   43</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   44</span>    img = imread(imgfilename)</div>
<div class="line"><span class="lineno">   45</span>    vroi = img[(roi[1]) : (roi[3]), (roi[0]) : (roi[2])].flattenlist()</div>
<div class="line"><span class="lineno">   46</span>    <span class="keywordflow">return</span> vroi</div>
<div class="line"><span class="lineno">   47</span> </div>
<div class="line"><span class="lineno">   48</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="ae996c0f2a121597af974fa1852099033" name="ae996c0f2a121597af974fa1852099033"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae996c0f2a121597af974fa1852099033">&#9670;&#160;</a></span>removeFF()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">nsCamera.utils.FlatField.removeFF </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>filename</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>directory</em><span class="paramdefsep"> = </span><span class="paramdefval">&quot;&quot;</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>roi</em><span class="paramdefsep"> = </span><span class="paramdefval">[0,&#160;0,&#160;512,&#160;1024]</span></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_flat_field_8py_source.html#l00106">106</a> of file <a class="el" href="_flat_field_8py_source.html">FlatField.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  106</span><span class="keyword">def </span>removeFF(filename, directory=&quot;&quot;, roi=[0, 0, 512, 1024]):</div>
<div class="line"><span class="lineno">  107</span>    <span class="keywordflow">if</span> directory:</div>
<div class="line"><span class="lineno">  108</span>        cwd = os.getcwd()</div>
<div class="line"><span class="lineno">  109</span>        newpath = os.path.join(cwd, directory)</div>
<div class="line"><span class="lineno">  110</span>        os.chdir(newpath)</div>
<div class="line"><span class="lineno">  111</span>    framenum = re.search(<span class="stringliteral">&quot;Frame_(\d)&quot;</span>, filename).group(1)</div>
<div class="line"><span class="lineno">  112</span>    gainFilename = <span class="stringliteral">&quot;px_gain_f&quot;</span> + framenum + <span class="stringliteral">&quot;.txt&quot;</span></div>
<div class="line"><span class="lineno">  113</span>    gainall = np.loadtxt(gainFilename)</div>
<div class="line"><span class="lineno">  114</span>    gain = gainall[(roi[1]) : (roi[3]), (roi[0]) : (roi[2])]</div>
<div class="line"><span class="lineno">  115</span>    offFilename = <span class="stringliteral">&quot;px_off_f&quot;</span> + framenum + <span class="stringliteral">&quot;.txt&quot;</span></div>
<div class="line"><span class="lineno">  116</span>    offsetall = np.loadtxt(offFilename, dtype=<span class="stringliteral">&quot;uint32&quot;</span>)</div>
<div class="line"><span class="lineno">  117</span>    offset = offsetall[(roi[1]) : (roi[3]), (roi[0]) : (roi[2])]</div>
<div class="line"><span class="lineno">  118</span> </div>
<div class="line"><span class="lineno">  119</span>    beforeImageall = imread(filename)</div>
<div class="line"><span class="lineno">  120</span>    beforeImage = beforeImageall[(roi[1]) : (roi[3]), (roi[0]) : (roi[2])]</div>
<div class="line"><span class="lineno">  121</span>    imageMed = np.median(beforeImage)</div>
<div class="line"><span class="lineno">  122</span> </div>
<div class="line"><span class="lineno">  123</span>    flat = imageMed * gain + offset</div>
<div class="line"><span class="lineno">  124</span>    flat = flat.clip(0)</div>
<div class="line"><span class="lineno">  125</span>    fix = beforeImage - flat</div>
<div class="line"><span class="lineno">  126</span>    clipped = fix.clip(0)</div>
<div class="line"><span class="lineno">  127</span>    fixinit = clipped.astype(<span class="stringliteral">&quot;uint16&quot;</span>)</div>
<div class="line"><span class="lineno">  128</span>    fiximg = Image.fromarray(fixinit)</div>
<div class="line"><span class="lineno">  129</span> </div>
<div class="line"><span class="lineno">  130</span>    fixFilename = filename[:-4] + <span class="stringliteral">&quot;ff&quot;</span> + filename[-4:]</div>
<div class="line"><span class="lineno">  131</span>    fiximg.save(fixFilename)</div>
<div class="line"><span class="lineno">  132</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="af674d4ff04cb43f0cfbe5f332661107f" name="af674d4ff04cb43f0cfbe5f332661107f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af674d4ff04cb43f0cfbe5f332661107f">&#9670;&#160;</a></span>removeFFall()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">nsCamera.utils.FlatField.removeFFall </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>directory</em><span class="paramdefsep"> = </span><span class="paramdefval">&quot;&quot;</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>FRAMES</em><span class="paramdefsep"> = </span><span class="paramdefval">[&quot;Frame_0&quot;,&#160;&quot;Frame_1&quot;,&#160;&quot;Frame_2&quot;,&#160;&quot;Frame_3&quot;]</span>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>roi</em><span class="paramdefsep"> = </span><span class="paramdefval">[0,&#160;0,&#160;512,&#160;1024]</span></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_flat_field_8py_source.html#l00133">133</a> of file <a class="el" href="_flat_field_8py_source.html">FlatField.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  137</span>):</div>
<div class="line"><span class="lineno">  138</span>    cwd = os.getcwd()</div>
<div class="line"><span class="lineno">  139</span>    <span class="keywordflow">if</span> directory:</div>
<div class="line"><span class="lineno">  140</span>        newpath = os.path.join(cwd, directory)</div>
<div class="line"><span class="lineno">  141</span>    <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  142</span>        newpath = cwd</div>
<div class="line"><span class="lineno">  143</span>    os.chdir(newpath)</div>
<div class="line"><span class="lineno">  144</span>    files = next(os.walk(<span class="stringliteral">&quot;./&quot;</span>))[2]</div>
<div class="line"><span class="lineno">  145</span>    filelist = []</div>
<div class="line"><span class="lineno">  146</span>    <span class="keywordflow">for</span> frame <span class="keywordflow">in</span> FRAMES:</div>
<div class="line"><span class="lineno">  147</span>        filelist.extend([k <span class="keywordflow">for</span> k <span class="keywordflow">in</span> files <span class="keywordflow">if</span> frame <span class="keywordflow">in</span> k <span class="keywordflow">and</span> <span class="stringliteral">&quot;tif&quot;</span> <span class="keywordflow">in</span> k])</div>
<div class="line"><span class="lineno">  148</span>    <span class="keywordflow">for</span> fname <span class="keywordflow">in</span> filelist:</div>
<div class="line"><span class="lineno">  149</span>        removeFF(fname, directory, roi)</div>
<div class="line"><span class="lineno">  150</span> </div>
<div class="line"><span class="lineno">  151</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="a6f78b2edfbe435cff069ea2f66c82e2d" name="a6f78b2edfbe435cff069ea2f66c82e2d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f78b2edfbe435cff069ea2f66c82e2d">&#9670;&#160;</a></span>tslopes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">nsCamera.utils.FlatField.tslopes </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>x</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>y</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">theilslopes implements a method for robust linear regression.
It computes the slope as the median of all slopes between paired values.
</pre> 
<p class="definition">Definition at line <a class="el" href="_flat_field_8py_source.html#l00049">49</a> of file <a class="el" href="_flat_field_8py_source.html">FlatField.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   49</span><span class="keyword">def </span>tslopes(x, y):</div>
<div class="line"><span class="lineno">   50</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   51</span><span class="stringliteral">    theilslopes implements a method for robust linear regression.</span></div>
<div class="line"><span class="lineno">   52</span><span class="stringliteral">    It computes the slope as the median of all slopes between paired values.</span></div>
<div class="line"><span class="lineno">   53</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><span class="lineno">   54</span>    val = theilslopes(x, y)</div>
<div class="line"><span class="lineno">   55</span>    <span class="keywordflow">return</span> [val[0], val[1]]</div>
<div class="line"><span class="lineno">   56</span> </div>
<div class="line"><span class="lineno">   57</span> </div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ab9e79cc1cb20a69c92dfa2d5012d52ab" name="ab9e79cc1cb20a69c92dfa2d5012d52ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab9e79cc1cb20a69c92dfa2d5012d52ab">&#9670;&#160;</a></span>action</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">nsCamera.utils.FlatField.action</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_flat_field_8py_source.html#l00157">157</a> of file <a class="el" href="_flat_field_8py_source.html">FlatField.py</a>.</p>

</div>
</div>
<a id="aa8e8aa32409d2ee808364172b3ed4ef9" name="aa8e8aa32409d2ee808364172b3ed4ef9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa8e8aa32409d2ee808364172b3ed4ef9">&#9670;&#160;</a></span>args</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">nsCamera.utils.FlatField.args = parser.parse_args()</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_flat_field_8py_source.html#l00167">167</a> of file <a class="el" href="_flat_field_8py_source.html">FlatField.py</a>.</p>

</div>
</div>
<a id="a775f9059ac91b55f234f75a4b3a562c2" name="a775f9059ac91b55f234f75a4b3a562c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a775f9059ac91b55f234f75a4b3a562c2">&#9670;&#160;</a></span>default</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">nsCamera.utils.FlatField.default</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_flat_field_8py_source.html#l00157">157</a> of file <a class="el" href="_flat_field_8py_source.html">FlatField.py</a>.</p>

</div>
</div>
<a id="a60151a4f4eef470251c86a9883022095" name="a60151a4f4eef470251c86a9883022095"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a60151a4f4eef470251c86a9883022095">&#9670;&#160;</a></span>dest</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">nsCamera.utils.FlatField.dest</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_flat_field_8py_source.html#l00157">157</a> of file <a class="el" href="_flat_field_8py_source.html">FlatField.py</a>.</p>

</div>
</div>
<a id="a6d1d81834ed2bf0e506f3132781aa8af" name="a6d1d81834ed2bf0e506f3132781aa8af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6d1d81834ed2bf0e506f3132781aa8af">&#9670;&#160;</a></span>directory</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">nsCamera.utils.FlatField.directory</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_flat_field_8py_source.html#l00169">169</a> of file <a class="el" href="_flat_field_8py_source.html">FlatField.py</a>.</p>

</div>
</div>
<a id="ac92f16b1d6d472f96079c4424a03bc8a" name="ac92f16b1d6d472f96079c4424a03bc8a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac92f16b1d6d472f96079c4424a03bc8a">&#9670;&#160;</a></span>framelist</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">nsCamera.utils.FlatField.framelist = [&quot;Frame_&quot; + str(frame) for frame in args.frames]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_flat_field_8py_source.html#l00168">168</a> of file <a class="el" href="_flat_field_8py_source.html">FlatField.py</a>.</p>

</div>
</div>
<a id="ad7aef75a54abd0b012003739038ee380" name="ad7aef75a54abd0b012003739038ee380"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad7aef75a54abd0b012003739038ee380">&#9670;&#160;</a></span>help</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">nsCamera.utils.FlatField.help</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_flat_field_8py_source.html#l00157">157</a> of file <a class="el" href="_flat_field_8py_source.html">FlatField.py</a>.</p>

</div>
</div>
<a id="a918fc8083a2b6bf4a422bd1a787d76d4" name="a918fc8083a2b6bf4a422bd1a787d76d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a918fc8083a2b6bf4a422bd1a787d76d4">&#9670;&#160;</a></span>nargs</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">nsCamera.utils.FlatField.nargs</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_flat_field_8py_source.html#l00161">161</a> of file <a class="el" href="_flat_field_8py_source.html">FlatField.py</a>.</p>

</div>
</div>
<a id="a833f8f4dd0c2e38167b83428f50f6d19" name="a833f8f4dd0c2e38167b83428f50f6d19"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a833f8f4dd0c2e38167b83428f50f6d19">&#9670;&#160;</a></span>parser</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">nsCamera.utils.FlatField.parser = argparse.ArgumentParser()</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="_flat_field_8py_source.html#l00155">155</a> of file <a class="el" href="_flat_field_8py_source.html">FlatField.py</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
